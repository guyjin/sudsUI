<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/3.8/js/dojo/dijit/themes/claro/claro.css"/>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/3.8/js/esri/css/esri.css"/>

    <link href="../css/index.css" rel="stylesheet" media="screen"/>
    <link href="../css/suds.css" rel="stylesheet" media="screen"/>
    <script src="../nrmcore/jquery/jquery-1.10.2.min.js"></script>
    <script src="../nrmcore/bootstrap/js/bootstrap.min.js"></script>
    <script src="jquery.easing.1.3.js"></script>
    <title>Cost Recovery</title>

</head>

<body>
<div class="ui-layout-center ui-layout-container">
    <div class="ui-layout-center ui-layout-data ui-layout-pane ui-layout-pane-center">
        <div class="container suds-container subflow">
            <div class="nrm-edit-form">
                <div id="renderView" class="costRecovery">
                    <div class="summaryHeader">
                        <div class="screenName">
                            <div class="name tabHeading soloTab">
                                Cost Recovery Processing
                            </div>
                        </div>
                    </div>
                    <div class="screenContent">
                        <div class="stepControls">
                            <button class="btn btn-link" type="submit">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-floppy-o fa-stack-1x fa-inverse"></i>
                                            </span>
                                Save &amp; Continue
                            </button>
                            <button class="btn btn-link resetQuestions" type="reset">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-refresh fa-stack-1x fa-inverse"></i>
                                            </span>
                                Reset
                            </button>

                            <button class="btn btn-link btn-cancel">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-ban fa-stack-1x fa-inverse"></i>
                                            </span>
                                Cancel
                            </button>
                        </div>
                        <div class="screenSections">
                            <div class="tabHeadingRow">
                                <div class="tabHeading">
                                    Recovery Processing
                                </div>
                            </div>
                            <div class="sections">
                                <div class="section">
                                    <div class="sectionTop">

                                        <div class="tabHeading sectionActionLink singleton">
                                            <a href="#"><i class="fa fa-download"></i> Download Agreement (PDF)</a>
                                        </div>
                                    </div>
                                    <div class="sectionContent">
                                        <div class="badgeCards">
                                            <div class="badgeCard active">
                                                <div class="badgeCardHeader">
                                                    <div class="badgeCardIcon"></div>
                                                    <div class="badgeCardLabel">
                                                        Worksheet Summary
                                                    </div>
                                                    <div class="badgeCardActionTab">
                                                        <a href="#" class="editWorksheetLink"><span
                                                                class="glyphicon glyphicon-pencil"></span> Edit</a>
                                                    </div>
                                                </div>
                                                <div class="badgeCardContent">
                                                    <div class="badgeCardData circleBadges">
                                                        <!--<div class="simpleBadgeBlock">-->
                                                        <!--&lt;!&ndash;<div class="dataPointLabel">&ndash;&gt;-->
                                                        <!--&lt;!&ndash;Category&ndash;&gt;-->
                                                        <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                                        <!--<div class="dataPoint">5</div>-->

                                                        <!--</div>-->
                                                        <div class="svgBadge info">
                                                            <svg viewBox="0 0 100 100"
                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                 xmlns:xhtml="http://www.w3.org/1999/xhtml"
                                                                 xmlns:xlink="http://www.w3.org/1999/xlink">
                                                                <defs>
                                                                </defs>
                                                                <g class="badgeField">
                                                                    <circle cx="50%" cy="50%" r="50%"/>
                                                                    <text x="49%" y="50%" dy=".3em" text-anchor="middle">5</text>
                                                                </g>
                                                                
                                                                <g id="badgeLabel">
                                                                    <text>
                                                                        <textPath xlink:href="#myPath" startOffset="25%"
                                                                                  text-anchor="middle">
                                                                            category
                                                                        </textPath>
                                                                    </text>
                                                                </g>

                                                            </svg>
                                                        </div>
                                                        <div class="svgBadge info agencyHours">
                                                            <svg viewBox="0 0 100 100"
                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                 xmlns:xhtml="http://www.w3.org/1999/xhtml"
                                                                 xmlns:xlink="http://www.w3.org/1999/xlink">
                                                                <defs>
                                                                </defs>
                                                                <g class="badgeField">
                                                                    <circle cx="50%" cy="50%" r="50%"/>
                                                                    <text x="49%" y="50%" dy=".3em"
                                                                          text-anchor="middle">50+
                                                                    </text>
                                                                </g>
                                                                <use xlink:href="#myPath" fill="none"/>
                                                                <g class="badgeLabel">
                                                                    <text>
                                                                        <textPath xlink:href="#myPath" startOffset="25%"
                                                                                  text-anchor="middle">
                                                                            agency time (hours)
                                                                        </textPath>
                                                                    </text>
                                                                </g>

                                                            </svg>
                                                        </div>
                                                        <div class="svgBadge info fee">
                                                            <svg viewBox="0 0 100 100"
                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                 xmlns:xhtml="http://www.w3.org/1999/xhtml"
                                                                 xmlns:xlink="http://www.w3.org/1999/xlink">
                                                                <defs>
                                                                </defs>
                                                                <g class="badgeField">
                                                                    <circle cx="50%" cy="50%" r="50%"/>
                                                                    <text x="49%" y="50%" dy=".3em" text-anchor="middle">$0.00</text>
                                                                </g>
                                                                <use xlink:href="#myPath" fill="none"/>
                                                                <text>
                                                                    <textPath xlink:href="#myPath" startOffset="25%" text-anchor="middle">fee</textPath>
                                                                </text>

                                                            </svg>
                                                        </div>
                                                        <div class="svgBadge info useCode">
                                                            <svg viewBox="0 0 100 100"
                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                 xmlns:xhtml="http://www.w3.org/1999/xhtml"
                                                                 xmlns:xlink="http://www.w3.org/1999/xlink">
                                                                <defs>
                                                                </defs>
                                                                <g class="badgeField">
                                                                    <circle cx="50%" cy="50%" r="50%"/>
                                                                    <text x="49%" y="50%" dy=".3em" text-anchor="middle">591</text>
                                                                </g>
                                                                <use xlink:href="#myPath" fill="none"/>
                                                                <text>
                                                                    <textPath xlink:href="#myPath" startOffset="25%" text-anchor="middle">use code</textPath>
                                                                </text>

                                                            </svg>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="badgeCard active">
                                                <div class="badgeCardHeader">
                                                    <div class="badgeCardIcon"></div>
                                                    <div class="badgeCardLabel">
                                                        NEPA Category
                                                    </div>

                                                </div>
                                                <div class="badgeCardContent">
                                                    <div class="badgeCardData">
                                                        <div class="badgeCardDataText">
                                                            <div class="categoryFields">
                                                                <div class="form-group">
                                                                    <label for="nepaCategory">NEPA Category</label>
                                                                    <select name="nepaCategory" id="nepaCategory"
                                                                            class="form-control suds-select" required>
                                                                        <option value="">Select NEPA Category</option>
                                                                        <option value="CE">CE</option>
                                                                        <option value="EA">EA</option>
                                                                        <option value="EIS">EIS</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <!--<div class="estimatedHoursFields">-->
                                                                <!--<div class="form-group">-->
                                                                    <!--<label for="estimatedHours">Estimated Hours</label>-->

                                                                        <!--<input type="number" name="estimatedHours"-->
                                                                               <!--id="estimatedHours" placeholder="0"-->
                                                                               <!--class="form-control">-->

                                                                <!--</div>-->
                                                                <!--<div class="form-group">-->
                                                                    <!--<label for="minutes">Minutes</label>-->
                                                                    <!--<select name="minutes" id="minutes"-->
                                                                            <!--class="form-control">-->
                                                                        <!--<option value=".00">.00</option>-->
                                                                        <!--<option value=".25">.25</option>-->
                                                                        <!--<option value=".50">.50</option>-->
                                                                        <!--<option value=".75">.75</option>-->
                                                                    <!--</select>-->
                                                                <!--</div>-->
                                                            <!--</div>-->

                                                            <div class="adjustmentFields">
                                                                <div class="form-group">
                                                                    <label for="adjustmentType">Adjustment Type</label>
                                                                    <select name="adjustmentType" id="adjustmentType"
                                                                            class="form-control adjustments suds-select"
                                                                            disabled>
                                                                        <option value="">Select Type</option>
                                                                        <option value="full">Full Waiver Cost Recovery
                                                                        </option>
                                                                        <option value="cat6Monitoring" disabled>Reduction,
                                                                            Monitoring Category 6
                                                                        </option>
                                                                        <option value="cat6Processing" disabled>Reduction,
                                                                            Processing Category 6
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="adjustmentAmount">
                                                                        Adjustment Amount
                                                                    </label>
                                                                    <input type="number" name="adjustmentAmount"
                                                                           id="adjustmentAmount"
                                                                           placeholder="0.00"
                                                                           class="form-control adjustments suds-input" disabled>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var pageTransitionTime = 800;
    (function (jQuery) {
        var screenSections = $('.screenSections');
        var renderView = $('.nrm-edit-form');
        setTimeout(function () {
            $('.suds-container').animate({
                opacity: 1,
                left: 0
            }, pageTransitionTime, 'easeOutCirc')
        }, 500);
        var categories = [
            {
                'label': '0-1 Hours',
                'fee': '$0.00'
            },
            {
                'label': '1-8 Hours',
                'fee': '$123.00'
            },
            {
                'label': '8-24 Hours',
                'fee': '$433.00'
            },
            {
                'label': '24-36 Hours',
                'fee': '$816.00'
            },
            {
                'label': '36-50 Hours',
                'fee': '$1170.00'
            },
            {
                'label': 'Out of Range',
                'fee': '$---'
            }

        ];
        var badge = $('.badge');
        var hours = $('#estimatedHours');
        var minutes = $('#minutes');
        var timeRange = $('.timeRange');
        var timeFee = $('.timeFee');
        var adjustedFee = '';
        $('.formSet').on('change keyup', function () {
            checkRange()
        });

        $('#adjustmentType').on('change', function () {
            if ($(this).val() === '') {
                $('#adjustmentAmount').val('');
                checkRange();
            }
            if ($(this).val() === 'full') {
                var newFee = $(timeFee).text().substr(1);
                $('#adjustmentAmount').val(parseFloat('-' + newFee).toFixed(2)).attr('disabled', true);
                $(timeFee).text('$0.00')

            }
        });

        $('.editWorksheetLink').on('click', function () {
            $('.suds-container').animate({
                opacity: 0,
                left: 800
            }, pageTransitionTime, 'easeOutCirc');

            setTimeout(function () {
                window.location.href = 'costRecoveryWorksheet.html';
//                history.back();
            }, pageTransitionTime);
        });


        function setValues(category) {
            if (category !== '') {
                badge.text(category);
                timeRange.text(categories[category].label);
                timeFee.text(categories[category].fee);
                $('.adjustments').attr('disabled', false);
                if (!badge.hasClass('hasCategory')) {
                    badge.addClass('hasCategory');
                }
            } else {
                badge.text('?');
                badge.removeClass('hasCategory');
                timeRange.text('Unknown');
                timeFee.text('$0.00');
            }
        }

        function checkRange() {

            var time = buildTime();
            var category = 0;
            if (time < 1) {
                category = 0;
            } else if (time.between(1, 8)) {
                category = 1;
            } else if (time.between(8, 24)) {
                category = 2;
            } else if (time.between(24, 36)) {
                category = 3;
            } else if (time.between(36, 50)) {
                category = 4;
            } else if (time.between(50, 9999999999999999999999999999999999999999999999)) {
                category = 5;
            }
            setValues(category);

        }

        function buildTime() {
            var inputHours = 0;
            if (hours.val()) {
                inputHours = hours.val();
            }
            var selectedMinutes = minutes.val();
            return parseFloat(inputHours + selectedMinutes);
        }

        Number.prototype.between = function (min, max) {
            return this >= min && this <= max;
        };

        var newPath = document.createElementNS('http://www.w3.org/2000/svg', "path");
        newPath.setAttribute("id", "myPath");
        newPath.setAttribute("fill", "transparent");
        newPath.setAttribute("d", circlePath(50, 50, 37));

        document.getElementsByTagName('defs')[0].appendChild(newPath);

        function circlePath(cx, cy, r) {
            return 'M ' + cx + ' ' + cy + ' m -' + r + ', 0 a ' + r + ',' + r + ' 0 1,1 ' + (r * 2) + ',0 a ' + r + ',' + r + ' 0 1,1 -' + (r * 2) + ',0';
        }



        $('.stepControls button[type=submit]').on('click', function () {
            backToCaseFile();
        });
    })();

    var backToCaseFile = function(){
        $('.suds-container').animate({
            opacity: 0,
            left: 800
        }, pageTransitionTime, 'easeOutCirc');

        setTimeout(function() {
            window.location.href = 'caseFile.html';
//            history.back();
        }, pageTransitionTime);
    }

</script>
</body>
</html>
