<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/3.8/js/dojo/dijit/themes/claro/claro.css"/>
    <link rel="stylesheet" type="text/css" href="https://js.arcgis.com/3.8/js/esri/css/esri.css"/>

    <link href="../css/index.css" rel="stylesheet" media="screen"/>
    <link href="../css/suds.css" rel="stylesheet" media="screen"/>
    <script src="../nrmcore/jquery/jquery-1.10.2.min.js"></script>
    <script src="../nrmcore/bootstrap/js/bootstrap.min.js"></script>
    <script src="jquery.easing.1.3.js"></script>
    <title>Rent Worksheet</title>

</head>

<body>
<div class="ui-layout-center ui-layout-container">
    <div class="ui-layout-center ui-layout-data ui-layout-pane ui-layout-pane-center">

        <div class="container suds-container subflow">

            <div class="nrm-edit-form">
                <div id="renderView" class="rentSheetWorksheet">
                    <div class="summaryHeader">
                        <div class="screenName">
                            <div class="name tabHeading soloTab">
                                Rent Worksheet
                            </div>
                        </div>
                    </div>
                    <div class="screenContent">
                        <div class="stepControls">
                            <button class="btn btn-link" type="submit">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-floppy-o fa-stack-1x fa-inverse"></i>
                                            </span>
                                Save &amp; Continue
                            </button>
                            <button class="btn btn-link resetQuestions" type="reset">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-refresh fa-stack-1x fa-inverse"></i>
                                            </span>
                                Reset
                            </button>

                            <button class="btn btn-link btn-cancel">
                                            <span class="fa-stack ">
                                              <i class="fa fa-circle fa-stack-2x"></i>
                                              <i class="fa fa-ban fa-stack-1x fa-inverse"></i>
                                            </span>
                                Cancel
                            </button>
                        </div>
                        <div class="screenSections">
                            <div class="tabHeadingRow">
                                <div class="tabHeading">
                                    Entries
                                </div>
                            </div>
                            <div class="sections">
                                <div class="section">
                                    <div class="sectionTop">

                                        <div class="tabHeading sectionActionLink singleton addNewButton">
                                            <a href="#" data-toggle="modal"><span
                                                    class="glyphicon glyphicon-plus"></span> Add New Entry</a>
                                        </div>
                                    </div>
                                    <div class="sectionContent">
                                        <div class="noEntriesFound">
                                            <div class="message message-info">
                                                No entries were found
                                            </div>
                                        </div>
                                        <div class="entriesTable">
                                            <div class="tabHeading tableCountyLabelTab">
                                                County1
                                            </div>
                                            <table class="table  table-condensed table-striped suds-table">
                                                <thead>
                                                <tr>
                                                    <th>State</th>
                                                    <th>County</th>
                                                    <th>Forest</th>
                                                    <th>Width (ft)</th>
                                                    <th>Length (ft)</th>
                                                    <th>Kilovolts</th>
                                                    <th>Acres</th>
                                                    <th>Rate</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody class="entriesRows">

                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="entriesTable">
                                            <div class="tabHeading tableCountyLabelTab">
                                                County2
                                            </div>
                                            <table class="table  table-condensed table-striped suds-table">
                                                <thead>
                                                <tr>
                                                    <th>State</th>
                                                    <th>County</th>
                                                    <th>Forest</th>
                                                    <th>Width (ft)</th>
                                                    <th>Length (ft)</th>
                                                    <th>Kilovolts</th>
                                                    <th>Acres</th>
                                                    <th>Rate</th>
                                                    <th>Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody class="entriesRows">

                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--
                                Table of entries.  Only shown when there *are* entries
                            -->


                            <!--
                                End Table of Entries.
                            -->

                            <!--
                               Start the summary grid at the bottom of the screen
                           -->
                            <div class="tabHeadingRow">
                                <div class="tabHeading">
                                    Summary
                                </div>
                            </div>
                            <div class="sections">
                                <div class="section">
                                    <div class="sectionContent">

                                        <div class="badgeCards summaries">
                                            <div class="badgeCard active" data-card-type="fee">
                                                <div class="badgeCardHeader">
                                                    <div class="badgeCardIcon"></div>
                                                    <div class="badgeCardLabel">
                                                        Rent
                                                    </div>
                                                </div>
                                                <div class="badgeCardContent">
                                                    <div class="badgeCardData">
                                                        <div class="badgeCardDataText rent">
                                                            $0.00
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="badgeCard active" data-card-type="lands">
                                                <div class="badgeCardHeader">
                                                    <div class="badgeCardIcon"></div>
                                                    <div class="badgeCardLabel">
                                                        Acres
                                                    </div>
                                                </div>
                                                <div class="badgeCardContent">
                                                    <div class="badgeCardData">
                                                        <div class="badgeCardDataText acres">
                                                            0.00
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="badgeCard active" data-card-type="roads">
                                                <div class="badgeCardHeader">
                                                    <div class="badgeCardIcon"></div>
                                                    <div class="badgeCardLabel">
                                                        Miles
                                                    </div>
                                                </div>
                                                <div class="badgeCardContent">
                                                    <div class="badgeCardData">
                                                        <div class="badgeCardDataText miles">
                                                            0.00
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!--
                                End the summary blocks
                            -->


                            <!--
                                Call to action when there are no other entries
                            -->


                        </div>


                    </div>
                    <div id="addToWorksheetModal" class="modal fade">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                            aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">Worksheet Entry</h4>
                                </div>
                                <div class="modal-body">
                                    <form name="rentSheetForm" id="rentSheetForm" class="rentSheetForm">
                                        <div class="worksheetFormRow">
                                            <div class="worksheetForm form1">
                                                <div class="worksheetFormField">
                                                    <label for="selectedState">
                                                        State
                                                    </label>
                                                    <select name="selectedState" id="selectedState"
                                                    class="form-control suds-select" required >
                                                        <option value="">Select a State</option>
                                                        <option value="AL">Alabama</option>
                                                        <option value="AK">Alaska</option>
                                                        <option value="AZ">Arizona</option>
                                                        <option value="AR">Arkansas</option>
                                                        <option value="CA">California</option>
                                                        <option value="CO">Colorado</option>
                                                        <option value="CT">Connecticut</option>
                                                        <option value="DE">Delaware</option>
                                                        <option value="DC">District Of Columbia</option>
                                                        <option value="FL">Florida</option>
                                                        <option value="GA">Georgia</option>
                                                        <option value="HI">Hawaii</option>
                                                        <option value="ID">Idaho</option>
                                                        <option value="IL">Illinois</option>
                                                        <option value="IN">Indiana</option>
                                                        <option value="IA">Iowa</option>
                                                        <option value="KS">Kansas</option>
                                                        <option value="KY">Kentucky</option>
                                                        <option value="LA">Louisiana</option>
                                                        <option value="ME">Maine</option>
                                                        <option value="MD">Maryland</option>
                                                        <option value="MA">Massachusetts</option>
                                                        <option value="MI">Michigan</option>
                                                        <option value="MN">Minnesota</option>
                                                        <option value="MS">Mississippi</option>
                                                        <option value="MO">Missouri</option>
                                                        <option value="MT">Montana</option>
                                                        <option value="NE">Nebraska</option>
                                                        <option value="NV">Nevada</option>
                                                        <option value="NH">New Hampshire</option>
                                                        <option value="NJ">New Jersey</option>
                                                        <option value="NM">New Mexico</option>
                                                        <option value="NY">New York</option>
                                                        <option value="NC">North Carolina</option>
                                                        <option value="ND">North Dakota</option>
                                                        <option value="OH">Ohio</option>
                                                        <option value="OK">Oklahoma</option>
                                                        <option value="OR">Oregon</option>
                                                        <option value="PA">Pennsylvania</option>
                                                        <option value="RI">Rhode Island</option>
                                                        <option value="SC">South Carolina</option>
                                                        <option value="SD">South Dakota</option>
                                                        <option value="TN">Tennessee</option>
                                                        <option value="TX">Texas</option>
                                                        <option value="UT">Utah</option>
                                                        <option value="VT">Vermont</option>
                                                        <option value="VA">Virginia</option>
                                                        <option value="WA">Washington</option>
                                                        <option value="WV">West Virginia</option>
                                                        <option value="WI">Wisconsin</option>
                                                        <option value="WY">Wyoming</option>
                                                    </select>
                                                </div>
                                                <div class="worksheetFormField">
                                                    <label for="selectedCounty">
                                                        County
                                                    </label>
                                                    <select name="selectedCounty" id="selectedCounty"
                                                           class="form-control suds-select" required>
                                                        <option value="">Select a County</option>
                                                        <option value="county1">County 1</option>
                                                    </select>
                                                </div>
                                                <div class="worksheetFormField">
                                                    <label for="selectedForest">
                                                        Forest
                                                    </label>
                                                    <select name="selectedForest" id="selectedForest"
                                                           class="form-control suds-select" required>
                                                        <option value="">Select a Forest</option>
                                                        <option value="forest1">Forest 1</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="worksheetFormRow">
                                            <div class="worksheetForm form2">
                                                <div class="worksheetFormField">
                                                    <label for="width">
                                                        Width (feet)
                                                    </label>
                                                    <input type="number" name="width" id="width"
                                                           class="form-control suds-input" required>
                                                </div>
                                                <div class="worksheetFormFieldOperator">
                                                    X
                                                </div>
                                                <div class="worksheetFormField">
                                                    <label for="length">
                                                        Length (feet)
                                                    </label>
                                                    <input type="number" name="length" id="length"
                                                           class="form-control suds-input" required>
                                                </div>
                                                <div class="worksheetFormFieldOperator">
                                                    =
                                                </div>
                                                <div class="worksheetFormField">
                                                    <label for="acres">
                                                       Acres
                                                    </label>
                                                    <input type="number" name="acres" id="acres"
                                                           class="form-control suds-input" disabled>
                                                </div>
                                                <div class="worksheetFormField">
                                                    <label for="miles">
                                                       Miles
                                                    </label>
                                                    <input type="number" name="miles" id="miles"
                                                           class="form-control suds-input" disabled>
                                                </div>
                                            </div>

                                        </div>
                                            <div class="worksheetFormRow">
                                                <div class="worksheetForm form3">
                                                    <div class="worksheetFormField">
                                                        <label for="kilovolts">
                                                            Kilovolts
                                                        </label>
                                                        <input type="text" name="kilovolts" id="kilovolts"
                                                               class="form-control suds-input" required size="20">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="worksheetFormRow">

                                            </div>
                                        <div class="form-group">
                                            <label for="comments">
                                                Comments
                                            </label>
                                            <textarea name="comments" id="comments" cols="80" rows="5"
                                                      class="form-control suds-textarea"
                                                      required></textarea>
                                        </div>


                                        <div class="controls form-group">
                                            <button type="reset" class="btn btn-suds">
                                                <i class="fa fa-refresh"></i>
                                                Reset
                                            </button>
                                            <button type="submit" class="btn btn-suds suds-primary">
                                                <i class="fa fa-save"></i>
                                                Save
                                            </button>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                        </div>

                </div>
            </div>

        </div>
    </div>
</div>
<script type="text/javascript">
    var pageTransitionTime = 800;

    var worksheet = {
        openModal: function () {
            $('#addToWorksheetModal').modal('show');
        },
        closeModal: function () {
            $('#addToWorksheetModal').modal('hide');
        },
        saveEntry: function () {
            var entry = {
                "state": $('#selectedState').val(),
                "county": $('#selectedCounty').val(),
                "forest": $('#selectedForest').val(),
                "width": $('#width').val(),
                "length": $('#length').val(),
                "kilovolts": $('#kilovolts').val(),
                "comments":$('#comments').val() ,
                "acres":results.calculateAcresForSingleEntry($('#width').val(), $('#length').val())
            };

            entries.addEntry(entry);
            this.appendEntry(entry, results.entries.length - 1);
            results.updateSummaries();
            this.resetForm();
        },
        appendEntry: function (entry, index) {
            var template = $('#row-template').html();
            var row = $(template).clone();
            $(row).find('.state').html(entry.state);
            $(row).find('.county').html(entry.county);
            $(row).find('.forest').html(entry.forest);
            $(row).find('.width').html(entry.width);
            $(row).find('.length').html(entry.length);
            $(row).find('.kilovolts').html(entry.kilovolts);
            $(row).find('.acres').html(entry.acres);
            $(row).find('.btn').attr('data-index', index);
            $('.entriesRows').append(row);
        },
        resetForm: function () {
            $('form#rentSheetForm')[0].reset();
        },
        loadForEdit: function (index) {
            $('#specialistRole').val(results.entries[index].role);
            $('#specialistName').val(results.entries[index].name);
            $('#processingTimeEst').val(results.entries[index].processingTime);
            $('#monitoringTimeEst').val(results.entries[index].monitoringTime);
            $('#rate').val(results.entries[index].rate);
            $('#workScope').val(results.entries[index].scope);
        }


    };

    var entries = {
        checkForEntries: function () {
            return (results.entries.length > 0);
        },
        toggleNoEntriesWarning: function () {
            if (!this.checkForEntries()) {
                results.showNoEntries();
            } else if (this.checkForEntries()) {
                results.hideNoEntries();
            }
        },
        addEntry: function (entry) {
            results.entries.push(entry);
        }
    };

    var results = {
        entries: [],

        showNoEntries: function () {
            $('.rentSheetWorksheet').addClass('noEntries');
        },
        hideNoEntries: function () {
            $('.rentSheetWorksheet').removeClass('noEntries');
        }

        // Calculate Rent

        ,calculateTotalRent: function() {
            var x = this.calculateTotalAcres() * 92.23;
            return Number(Math.round(x+'e2')+'e-2')
        }

        // calculate Acres

        ,calculateAcresForSingleEntry: function(width, length) {
            var x = (width*length)/43560; 
            return Number(Math.round(x+'e2')+'e-2');
        } ,
        calculateTotalAcres: function() {
            var totalAcres = 0;
            for(i=0;i<results.entries.length; i++) {
                totalAcres = totalAcres + parseFloat(results.entries[i].acres);
            }
            return Number(Math.round(totalAcres+'e2')+'e-2')
        }

        // calculate Miles

        ,calculateTotalMiles: function() {
            var totalMiles = this.calculateTotalAcres() * 0.0015625;

            return Number(Math.round(totalMiles+'e2')+'e-2');
        }

        , updateSummaries: function() {
            var totalAcres = this.calculateTotalAcres();
            var rent = this.calculateTotalRent();
            var miles = this.calculateTotalMiles();
            $('.badgeCardDataText.rent').text("$" + rent);
            $('.badgeCardDataText.acres').text(totalAcres);
            $('.badgeCardDataText.miles').text(miles);
        }
    };

    Number.prototype.between = function (min, max) {
        return this >= min && this <= max;
    };

    (function ($) {
        var screenSections = $('.screenSections');
        var renderView = $('.nrm-edit-form');
        setTimeout(function () {
            $('.suds-container').animate({
                opacity: 1,
                left: 0
            }, pageTransitionTime, 'easeOutCirc')
        }, 500);
        $('.stepControls button[type=submit]').on('click', function () {
            toApplicationPage();
        });

        $('.addNewButton').on('click', function () {
            worksheet.openModal();
        });

        $('.editCloser').on('click', function () {
            worksheet.closeModal();
            worksheet.resetForm();
        });

        $(document).on('keyup', function (e) {
            if (e.keyCode === 27) {
                worksheet.closeModal();
            }
        });

        $(document).on('click', '.entriesRows .toggleMore', function () {
            $(this).parent().toggleClass('openScope')
        });

        $(document).on('click', '.entriesRows .editEntry', function () {
            var i = $(this).attr('data-index');
            worksheet.loadForEdit(i);
            worksheet.openModal();
        });

        $(document).on('click', '.entriesRows .removeEntry', function () {
            var i = $(this).attr('data-index');
            results.entries.splice(i, 1);
            $(this).closest('tr').next('tr').remove();
            $(this).closest('tr').remove();
            results.updateSummaries();
            entries.toggleNoEntriesWarning();
        });

        $('#rentSheetForm').on('submit', function (e) {
            e.preventDefault();
            worksheet.saveEntry();


            if (entries.checkForEntries()) {
                entries.toggleNoEntriesWarning();
                $('#addToWorksheetModal').modal('hide');
            }

        });

        $('#length').on('change', function() {
            var l = $(this).val();
            var w = $('#width').val();
            if(l !== 0 && w !== '') {
                $('#acres').val(results.calculateAcresForSingleEntry(w, l));
            }

        });

        entries.toggleNoEntriesWarning();


        // listen for click on summary button and open summary view.
        $('.summaryBlock').on('click', function () {

            $.get('summary.html', function (data) {
                $('#summaryModal').html(data).modal({
                    keyboard: true,
                    backdrop: 'static'
                });

                setTimeout(function () {
                    $('.summaryOverlay').addClass('loaded');
                }, 200);

                $('.summaryModalCloseBtn').on('click', function () {

                    $('.summaryOverlay').fadeOut(function () {
                        $('#summaryModal').html('').modal('hide');
                        $(this).off('click');
                    }).removeClass('loaded')

                })

            })


        });

        var toApplicationPage = function () {
            $('.suds-container').animate({
                opacity: 0,
                left: 800
            }, pageTransitionTime, 'easeOutCirc');

            setTimeout(function () {
            window.location.href = 'applicationCaseFile.html';
//                history.back();
            }, pageTransitionTime);
        };

        renderView.scroll(function () {

            if ($(this).scrollTop() > 52) {
                var t = $(this).offset().top + 16;
                $('.stepControls').addClass('fixed').css({
                    top: t + 'px'
                });

                $('.screenSections').css({
                    top: '60px'
                })
            } else {
                $('.stepControls').removeClass('fixed').removeAttr('style');

                $('.screenSections').removeAttr('style');
            }
        })
    })(jQuery);


</script>
<script id="row-template" type="text/x-custom-template">
    <tr>
        <td class="state"></td>
        <td class="county"></td>
        <td class="forest"></td>
        <td class="width"></td>
        <td class="length"></td>
        <td class="kilovolts"></td>
        <td class="acres"></td>
        <td>X.XX</td>
        <td class="editButtons">
            <button class="btn btn-xs btn-suds suds-primary editEntry" data-index="">
                <i class="fa fa-edit" aria-hidden="true"></i>
                EDIT
            </button>
            <button class="btn btn-xs btn-suds suds-danger removeEntry" data-index="">
                <i class="fa fa-times" aria-hidden="true"></i>
                REMOVE
            </button>
        </td>

    </tr>
    <tr class="subtotal">
        <td colspan="8">subtotal:</td>
        <td>$0.00</td>
    </tr>
    <!--<tr>-->
        <!--<td colspan="6" class="scopeRow">-->
            <!--<div class="scopeOfWork">-->
                <!--<span class="scopeSnippet">-->

                <!--</span>-->
                <!--<span class="scopeBody"></span>-->
                <!--<button class="btn btn-link toggleMore"><span class="more">...more</span><span-->
                        <!--class="less">...less</span></button>-->
            <!--</div>-->
        <!--</td>-->
    <!--</tr>-->
</script>


</body>

</html>